generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

// Enums
enum Settings {
    SERVER_SETTINGS
}

enum Status {
    DEFAULT
    NOPURCHASE
}

enum Stock {
    IN_STOCK
    OUT_STOCK
    DISCONTINUED
    HIDDEN
}

enum PaymentStatus {
    UNPAID
    PAID
    FAILED
    CANCELED
    REFUNDED
}

enum ShippingStatus {
    PENDING
    SHIPPED
    DELIVERED
    CANCELED
    UNKNOWN
}

// Database
model System {
    id       Settings @id @default(SERVER_SETTINGS)
    status   Status   @default(DEFAULT)
    currency String   @default("CAD")
    ratings  Boolean  @default(true)
}

model Products {
    id          String    @id @default(uuid())
    title       String
    subtitle    String?
    description String
    images      String    @db.VarChar(250) // String[] - split by ","
    tags        String    @db.VarChar(250) // String[] - split by ","
    price       Int // Amount in cents
    ratings     Ratings[]
    stock       Stock     @default(IN_STOCK)
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    @@fulltext([title])
    @@fulltext([title, subtitle])
}

model Ratings {
    id          String    @id @default(uuid())
    user        String
    name        String    @default("Anonymous")
    description String?
    rating      Float
    product     Products? @relation(fields: [productID], references: [id])
    productID   String?
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    @@unique([user, productID])
}

model Orders {
    id            String         @id @default(uuid())
    productID     String         @db.VarChar(450) // String[] - split by ","
    transactionID String         @unique
    userID        String
    status        PaymentStatus  @default(UNPAID)
    quantity      String         @db.VarChar(150) // String[] - split by ","
    amount        Int // Amount in cents
    email         String
    country       String
    postal        String
    shipping      ShippingStatus @default(UNKNOWN)
    createdAt     DateTime       @default(now())
    updatedAt     DateTime       @updatedAt
}
